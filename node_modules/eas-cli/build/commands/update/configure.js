"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const core_1 = require("@oclif/core");
const EasCommand_1 = tslib_1.__importDefault(require("../../commandUtils/EasCommand"));
const flags_1 = require("../../commandUtils/flags");
const log_1 = tslib_1.__importDefault(require("../../log"));
const configure_1 = require("../../update/configure");
class UpdateConfigure extends EasCommand_1.default {
    async runAsync() {
        const { flags } = await this.parse(UpdateConfigure);
        const platform = flags.platform;
        const { projectConfig: { projectId, exp, projectDir }, loggedIn: { graphqlClient }, } = await this.getContextAsync(UpdateConfigure, {
            nonInteractive: flags['non-interactive'],
        });
        log_1.default.log('ðŸ’¡ The following process will configure your project to run EAS Update. These changes only apply to your local project files and you can safely revert them at any time.');
        await (0, configure_1.ensureEASUpdatesIsConfiguredAsync)(graphqlClient, {
            exp,
            projectId,
            projectDir,
            platform,
        });
        log_1.default.addNewLineIfNone();
        log_1.default.log(`ðŸŽ‰ Your app is configured to run EAS Update!`);
    }
}
exports.default = UpdateConfigure;
_a = UpdateConfigure;
UpdateConfigure.description = 'configure the project to support EAS Update';
UpdateConfigure.flags = {
    platform: core_1.Flags.enum({
        description: 'Platform to configure',
        char: 'p',
        options: ['android', 'ios', 'all'],
        default: 'all',
    }),
    ...flags_1.EASNonInteractiveFlag,
};
UpdateConfigure.contextDefinition = {
    ..._a.ContextOptions.ProjectConfig,
    ..._a.ContextOptions.LoggedIn,
};
